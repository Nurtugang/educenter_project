{% extends "base.html" %}
{% load static %}
{% block content %}
<section id="page-banner" class="pt-55 pb-60 bg_cover" data-overlay="8">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-banner-cont">
                    <h2>Урок {{lesson.date}}</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'index' %}">Домашняя страница</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'journal_student' %}">Дневник</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Урок {{lesson.study_group.subject.name}} {{lesson.date}}</li>

                        </ol>
                    </nav>
                </div>  <!-- page banner cont -->
            </div>
        </div> <!-- row -->
    </div> <!-- container -->
</section>
<!--====== PAGE BANNER PART ENDS ======-->

<section class="pt-30 pb-30 gray-bg">
  <div class="container">
    <div class="row align-items-center">
      <div class="content-section col-lg-12 " style="background-color: white; padding: 30px;">
        <div class="row">
          
          <div class="col-md-4">
            <div class="info-box p-2 mb-3 text-center" style="border: 1px solid #ddd; border-radius: 8px;">
              <h6 class="info-title"><strong>Статус</strong></h6>
              {% if lesson.status == 'P' %}
                      Урок проведен
                  {% elif lesson.status == 'O' %}
                    {% if lesson.substitute_teacher %}
                      <a href="#" data-toggle="modal" data-target="#lessonModal" data-message="Урок отменен. Причина: {{lesson.reason_for_not_held}}<br>Была произведена замена учителя на {{lesson.substitute_teacher}}">Урок отменен</a>
                    {% else %}
                      <a href="#" data-toggle="modal" data-target="#lessonModal" data-message="Причина: {{lesson.reason_for_not_held}}">Урок отменен</a>
                    {% endif %}
                  {% elif lesson.status == 'Z' and lesson.substitute_teacher %}
                    <a href="#" data-toggle="modal" data-target="#lessonModal" data-message="Была произведена замена учителя на {{lesson.substitute_teacher.last_name}} {{lesson.substitute_teacher.first_name}}">Урок с заменой</a>
                  {% elif lesson.status == 'NP' %}
                    <a href="#" data-toggle="modal" data-target="#lessonModal" data-message="Не проведен">Урок не проведен</a>
                  {% endif %}
                </p>
                <!-- Модальное окно -->
                <div class="modal fade" id="lessonModal" tabindex="-1" role="dialog" aria-labelledby="lessonModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="lessonModalLabel">Детали урока</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body" id="lessonModalBody">
                        <!-- Здесь будет отображаться динамическое сообщение -->
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-box p-2 mb-3 text-center" style="border: 1px solid #ddd; border-radius: 8px;">
              <h6 class="info-title"><strong>Урок</strong></h6>
              <p class="mb-1">{{lesson.study_group.subject.name}} {{lesson.date}}</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-box p-2 mb-3 text-center" style="border: 1px solid #ddd; border-radius: 8px;">
              <h6 class="info-title"><strong>Домашнее задание</strong></h6>
              <p>
                <a href="#" id="homework-modal" data-toggle="modal" data-target="#homeworkModal" style="display: inherit;">
                {% if lesson.homework %}
                    Просмотреть домашнее задание
                {% else %}
                    Не назначено
                {% endif %}
                </a>
              </p>
              <!-- Модальное окно для добавления/редактирования домашнего задания -->
              <div class="modal fade" id="homeworkModal" tabindex="-1" role="dialog" aria-labelledby="homeworkModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg " role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="homeworkModalLabel">Просмотр домашнего задания</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                          <div id="homework-content">
                            <p style="white-space: pre-wrap">{{ lesson.homework|default:'Домашнее задание не задано' }}</p>
                        </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-classic btn-main btn-gray" data-dismiss="modal">Закрыть</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-box p-2 mb-3 text-center" style="border: 1px solid #ddd; border-radius: 8px;">
              <h6 class="info-title"><strong>Количество часов</strong></h6>
              <p class="mb-1">{{lesson.hours}}</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-box p-2 mb-3 text-center" style="border: 1px solid #ddd; border-radius: 8px;">
              <h6 class="info-title"><strong>Учитель</strong></h6>
              <p class="mb-1">{{lesson.study_group.teacher.first_name}} {{lesson.study_group.teacher.last_name}}
                {% if has_subs_teacher %}
                <span>(Учитель на замену:
                  {{lesson.substitute_teacher.first_name}} {{lesson.substitute_teacher.last_name}})
                  {% endif %}
                </span></p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="info-box p-2 mb-3 text-center" style="border: 1px solid #ddd; border-radius: 8px;">
                <h6 class="info-title"><strong>{{lesson.study_group.get_group_type_display}}</strong></h6>
                <p class="mb-1">{{lesson.study_group.name}}</p>
              </div>
            </div>
        </div>
        <div class="col-md-12 mt-3 mb-3" style="background-color: white; padding: 0px 30px">
					<h4 class="super-centered"><strong>Мои данные</strong></h4>
				</div>        
        <table class="table table-bordered">
          <thead>
              <tr>
                  <th class="text-center">Присутствие</th>
                  <th class="text-center">Оценка</th>
                  <th class="text-center">Комментарий к уроку</th>
              </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" >
                {{sa.get_attendance_status_display|default:' '}}
              </td>
              <td class="text-center">{{sa.mark|default:'-'}}</td>
              <td class="text-center">{{sa.comment|default:'-'}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
{% endblock content %} 

{% block last %}
<!-- Скрипт для изменения содержимого модального окна -->
<script>
  $('#lessonModal').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget); // Кнопка, которая вызвала модал
    var message = button.data('message'); // Извлечение данных

    var modal = $(this);
    modal.find('.modal-body').text(message); // Установка текста в модальном окне
  });
</script>
<script>
  document.querySelectorAll('#navbarSupportedContent ul li')[3].querySelector('a').classList.add('active');
</script>
{% endblock last %}