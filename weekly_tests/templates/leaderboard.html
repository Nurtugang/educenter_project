{% extends "base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'weekly_tests/style.css' %}">
{% endblock head %}

{% block content %}
<!--====== PAGE BANNER PART START ======-->
<section id="page-banner" class="pt-55 pb-60 bg_cover" data-overlay="8">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-banner-cont">
                    <h2>üèÜ –î–æ—Å–∫–∞ –ø–æ—á–µ—Ç–∞</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'index' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
                            <li class="breadcrumb-item active" aria-current="page">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>
<!--====== PAGE BANNER PART ENDS ======-->

<!--====== LEADERBOARD PART START ======-->
<section id="leaderboard-part" class="pt-55 pb-60">
    <div class="container">
        {% if current_test %}
            <!-- –¢–µ–∫—É—â–∏–π —Ç–µ—Å—Ç -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="leaderboard-card">
                        <div class="test-header">
                            <div class="test-period">
                                {{ current_test.week_start|date:"d.m.Y" }}¬†‚Äì¬†{{ current_test.week_end|date:"d.m.Y" }}
                            </div>
                            <div class="test-subjects">
                                {% for subject in current_test.subjects.all %}
                                <span>{{ subject.name }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        
                        {% if current_leaderboard %}
                            <!-- –ü–æ–¥–∏—É–º –¥–ª—è —Ç–æ–ø-3 -->
                            {% if current_leaderboard|length >= 3 %}
                                <div class="podium">
                                    <!-- 2 –º–µ—Å—Ç–æ -->
                                    <div class="podium-place">
                                        <div class="podium-step second">
                                            <div class="podium-avatar">
                                                {{ current_leaderboard.1.student.first_name|first }}{{ current_leaderboard.1.student.last_name|first }}
                                            </div>
                                            <div class="podium-name">{{ current_leaderboard.1.student.get_full_name }}</div>
                                            <div class="podium-score">{{ current_leaderboard.1.average_score }}%</div>
                                        </div>
                                    </div>
                                    
                                    <!-- 1 –º–µ—Å—Ç–æ -->
                                    <div class="podium-place">
                                        <div class="podium-crown">üëë</div>
                                        <div class="podium-step first">
                                            <div class="podium-avatar">
                                                {{ current_leaderboard.0.student.first_name|first }}{{ current_leaderboard.0.student.last_name|first }}
                                            </div>
                                            <div class="podium-name">{{ current_leaderboard.0.student.get_full_name }}</div>
                                            <div class="podium-score">{{ current_leaderboard.0.average_score }}%</div>
                                        </div>
                                    </div>
                                    
                                    <!-- 3 –º–µ—Å—Ç–æ -->
                                    <div class="podium-place">
                                        <div class="podium-step third">
                                            <div class="podium-avatar">
                                                {{ current_leaderboard.2.student.first_name|first }}{{ current_leaderboard.2.student.last_name|first }}
                                            </div>
                                            <div class="podium-name">{{ current_leaderboard.2.student.get_full_name }}</div>
                                            <div class="podium-score">{{ current_leaderboard.2.average_score }}%</div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            
                            <!-- –ü–æ–ª–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ -->
                            <!-- –ü–æ–ª–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ -->
<div style="padding: 20px;">
    <h5 style="margin-bottom: 20px; color: #07294d; text-align: center;">–ü–æ–ª–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</h5>
    <div class="row">
        <div class="col-md-6">
            {% for item in current_leaderboard %}
                {% if item.column == 'left' %}
                    <div class="rank-row-compact">
                        <div class="rank-number-small">{{ item.position }}</div>
                        <div class="rank-info-small">
                            <div class="rank-name-small">{{ item.student.get_full_name }}</div>
                            <div class="rank-score-small">{{ item.average_score }}%</div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
        <div class="col-md-6">
            {% for item in current_leaderboard %}
                {% if item.column == 'right' %}
                    <div class="rank-row-compact">
                        <div class="rank-number-small">{{ item.position }}</div>
                        <div class="rank-info-small">
                            <div class="rank-name-small">{{ item.student.get_full_name }}</div>
                            <div class="rank-score-small">{{ item.average_score }}%</div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>
                        {% else %}
                            <div class="no-results">
                                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –µ—â–µ –Ω–µ –≤–Ω–µ—Å–µ–Ω—ã</h4>
                                <p>–î–æ—Å–∫–∞ –ø–æ—á–µ—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ç–µ—Å—Ç—ã -->
            {% if previous_leaderboards %}
                <div class="row mt-5">
                    <div class="col-lg-12">
                        <h4 style="color: #07294d; margin-bottom: 30px;">–ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h4>
                        
                        {% for prev_test in previous_leaderboards %}
                            <div class="leaderboard-card">
                                <div class="collapse-header" data-toggle="collapse" data-target="#collapse-{{ forloop.counter }}">
                                    <div>
                                        <strong>{{ prev_test.test }}</strong>
                                        <div class="test-subjects">
                                            {% for subject in prev_test.test.subjects.all %}
                                                <span class="subject-badge">{{ subject.name }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <i class="fa fa-chevron-down"></i>
                                </div>
                                
                                <div id="collapse-{{ forloop.counter }}" class="collapse">
                                    {% if prev_test.leaderboard %}
                                        <div style="padding: 20px;">
                                            {% for item in prev_test.leaderboard %}
                                                <div class="rank-row">
                                                    <div class="rank-number">{{ item.position }}</div>
                                                    <div class="rank-info">
                                                        <div class="rank-name">{{ item.student.get_full_name }}</div>
                                                        <div class="rank-details">
                                                            –ü—Ä–µ–¥–º–µ—Ç—ã: 
                                                            {% for subject in item.subjects %}
                                                                {{ subject.subject }} ({{ subject.score }}%){% if not forloop.last %}, {% endif %}
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                    <div class="rank-score">{{ item.average_score }}%</div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="no-results">
                                            <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞</p>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            
        {% else %}
            <div class="row">
                <div class="col-lg-12">
                    <div class="no-results">
                        <h4>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—â–µ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–æ—Å—å</h4>
                        <p>–î–æ—Å–∫–∞ –ø–æ—á–µ—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞</p>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</section>
<!--====== LEADERBOARD PART ENDS ======-->
{% endblock content %}